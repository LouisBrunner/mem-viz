# `mem-viz`

This tool allows to display computer memory maps using various formats. It is intended as both a generic way to display memory from any system, language, library, etc (back-end) or as a way to read/parse specific memory maps and display them (front-end).

## Installation

```sh
go install github.com/LouisBrunner/mem-viz/cmd/mem-viz@latest
```

## Usage

```
Usage of mem-viz:
      --from-json ./blocks.json          use the JSON output from a previous run, e.g. ./blocks.json or `-` for stdin
      --from-json-text {"Name": "foo"}   use the JSON output from a previous run, e.g. {"Name": "foo"}
  -h, --help                             show this help message and exit
      --logging-level string             logrus log level for internal debugging, e.g. "debug" (default "error")
      --output string                    output format, one of: "graphviz", "latex", "markdown", "text", "ascii", "json" (default "text")
  -o, --output-file ./blocks.dot         output file, e.g. ./blocks.dot, defaults to stdout
```

In order to use `mem-viz` directly, you will need to provide a JSON document. See [Front-ends > JSON](#json) for more information.

## Front-ends

These are the possible ways to input memory maps for `mem-viz` to render.

### JSON

A JSON document saved from a previous run of a front-end, generated by another tool or handcrafted can be used as input.

Here is a rough schema of the format (see [here](pkg/contracts/memory.go) for full details):

```json
{
  "Name": "DSC",
  "Address": 7314554880,
  "Size": 0,
  "ParentOffset": 0,
  "Content": [
    {
      "Name": "Main Header Area",
      "Address": 7314554880,
      "Size": 0,
      "ParentOffset": 0,
      "Content": [
        {
          "Name": "Main Header (V3)",
          "Address": 7314554880,
          "Size": 512,
          "ParentOffset": 0,
          "Content": null,
          "Values": [
            {
              "Name": "Magic",
              "Offset": 0,
              "Size": 16,
              "Value": "dyld_v1  arm64e",
              "Links": null
            },
            {
              "Name": "MappingOffset",
              "Offset": 16,
              "Size": 4,
              "Value": "512 (0x200)",
              "Links": [
                {
                  "Name": "points to",
                  "TargetAddress": 7314555392
                }
              ]
            }
          ]
        },
        {
          "Name": "Mappings (6)",
          "Address": 7314555392,
          "Size": 0,
          "ParentOffset": 512,
          "Content": [
            {
              "Name": "Mapping 1/6",
              "Address": 7314555392,
              "Size": 32,
              "ParentOffset": 0,
              "Content": null,
              "Values": [
                {
                  "Name": "Address",
                  "Offset": 0,
                  "Size": 8,
                  "Value": "6442450944 (0x180000000)",
                  "Links": null
                },
                {
                  "Name": "Size",
                  "Offset": 8,
                  "Size": 8,
                  "Value": "1414856704 (0x54550000)",
                  "Links": null
                },
                {
                  "Name": "FileOffset",
                  "Offset": 16,
                  "Size": 8,
                  "Value": "0 (0x0)",
                  "Links": null
                },
                {
                  "Name": "MaxProt",
                  "Offset": 24,
                  "Size": 4,
                  "Value": "5 (0x5)",
                  "Links": null
                },
                {
                  "Name": "InitProt",
                  "Offset": 28,
                  "Size": 4,
                  "Value": "5 (0x5)",
                  "Links": null
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

### `dsc-viz`

This tool allows to display the format of a macOS/iOS dyld shared cache (DSC) file. It is also able to read the kernel-provided DSC in its memory.

Install it using:

```sh
go install github.com/LouisBrunner/mem-viz/cmd/dsc-viz@latest
```

Usage:

```
Usage of dsc-viz:
      --from-arch string                 architecture of the file to load
      --from-current-arch                load the file for the current architecture
      --from-file string                 file to load
      --from-json ./blocks.json          use the JSON output from a previous run, e.g. ./blocks.json or `-` for stdin
      --from-json-text {"Name": "foo"}   use the JSON output from a previous run, e.g. {"Name": "foo"}
      --from-memory                      load the memory from the current process
  -h, --help                             show this help message and exit
      --logging-level string             logrus log level for internal debugging, e.g. "debug" (default "error")
      --output string                    output format, one of: "graphviz", "latex", "markdown", "text", "ascii", "json" (default "text")
  -o, --output-file ./blocks.dot         output file, e.g. ./blocks.dot, defaults to stdout
```

You can use `--from-memory` or `--from-current-arch` to let the tool fetch the DSC from your system (respectively from memory or from a file on disk). Otherwise you can use `--from-file` to specify a file to fetch from or `--from-arch` to scan your system but for a specific architecture.

Other options are the same as `mem-viz` (same output formats supported, possibility to save/load JSON, etc).

## Output formats

A wide-range of output formats is supported.

### `text` (default)

TODO: unimplemented

### `ascii`

TODO: unimplemented

### `graphviz`

TODO: unimplemented

### `markdown`

TODO: unimplemented

### `latex`

TODO: unimplemented, see memory-maps in https://texdoc.org/serve/bytefield.pdf/0

### `json`

When using `mem-viz` directly, outputting `json` will just act as a noop: whatever you passed in will be echoed back. Do note that it will parse your input and check it, removing any unknown field. This is a good way to check if JSON format is valid though.

When using another front-end, it will output the JSON representation of the memory map, which can be saved then loaded later with one of the `--from-json*` flags.

```

```
